<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AI Chatbot by Talha-SE</title>
    <link rel="stylesheet" href="/admin/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="description" content="AI Chatbot Admin Dashboard by Talha-SE - Commercial License Required">
    <meta name="author" content="Talha-SE">
    <meta name="copyright" content="¬© 2025 Talha-SE. All rights reserved.">
    <!-- Vercel deployment meta tags -->
    <meta property="og:title" content="AI Chatbot Admin Dashboard">
    <meta property="og:description" content="Manage your AI chatbot, crawl websites, and monitor performance">
    <meta property="og:type" content="website">
    <script>
        // Ensure we're using the correct base URL in production
        window.API_BASE_URL = window.location.origin;
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Admin Dashboard</h1>
            <p>Manage your AI chatbot, crawl websites, and monitor performance</p>
            <small style="opacity: 0.8; font-size: 0.9rem;">¬© 2025 Talha-SE - Commercial License Required</small>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats" id="quick-stats">
            <div class="stat-card">
                <span class="stat-icon">üåê</span>
                <span class="stat-number" id="stat-websites">0</span>
                <span class="stat-label">Websites</span>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üìÑ</span>
                <span class="stat-number" id="stat-pages">0</span>
                <span class="stat-label">Total Pages</span>
            </div>
            <div class="stat-card">
                <span class="stat-icon">üí¨</span>
                <span class="stat-number" id="stat-conversations">0</span>
                <span class="stat-label">Conversations</span>
            </div>
            <div class="stat-card">
                <span class="stat-icon">‚ö°</span>
                <span class="stat-number" id="stat-active">Active</span>
                <span class="stat-label">Status</span>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Crawl New Website Section -->
            <div class="section crawl-section">
                <div class="section-header">
                    <h2>Crawl New Website</h2>
                </div>
                <form id="website-form">
                    <div class="form-group">
                        <label for="website-url" class="form-label">Website URL</label>
                        <input 
                            type="text" 
                            id="website-url" 
                            name="website-url" 
                            class="form-input"
                            required 
                            placeholder="example.com, www.example.com, or https://example.com"
                            autocomplete="url"
                        >
                        <div class="form-help">
                            Supports formats: example.com, www.example.com, https://example.com
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="max-pages" class="form-label">Max Pages</label>
                            <input 
                                type="number" 
                                id="max-pages" 
                                name="max-pages" 
                                class="form-input"
                                min="1" 
                                max="100" 
                                value="10"
                                title="Maximum number of pages to crawl (1-100)"
                            >
                        </div>
                        <div class="form-group">
                            <label for="max-depth" class="form-label">Max Depth</label>
                            <input 
                                type="number" 
                                id="max-depth" 
                                name="max-depth" 
                                class="form-input"
                                min="1" 
                                max="5" 
                                value="3"
                                title="Maximum crawling depth (1-5)"
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="include-external" name="include-external">
                            <span class="checkmark"></span>
                            Include External Links
                            <span class="checkbox-help">Crawl links to other domains (limited to prevent infinite crawling)</span>
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <span>üöÄ</span>
                            Crawl Website
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="showAdvancedOptions()">
                            <span>‚öôÔ∏è</span>
                            Advanced
                        </button>
                    </div>
                </form>

                <!-- Advanced Options (Initially Hidden) -->
                <div id="advanced-options" class="advanced-options" style="display: none;">
                    <h4>Advanced Crawling Options</h4>
                    <div class="form-group">
                        <label for="timeout" class="form-label">Request Timeout (seconds)</label>
                        <input 
                            type="number" 
                            id="timeout" 
                            name="timeout" 
                            class="form-input"
                            min="5" 
                            max="30" 
                            value="15"
                            title="Timeout for each page request (5-30 seconds)"
                        >
                    </div>
                </div>

                <div id="status-message"></div>
            </div>

            <!-- Quick Actions Section -->
            <div class="section">
                <div class="section-header">
                    <h2>Quick Actions</h2>
                </div>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <a href="/api/chat-interface" class="btn btn-primary" target="_blank">
                        <span>üí¨</span>
                        Test Chatbot
                    </a>
                    <button class="btn btn-secondary" onclick="refreshData()">
                        <span>üîÑ</span>
                        Refresh Data
                    </button>
                    <button class="btn btn-secondary" onclick="exportData()">
                        <span>üì•</span>
                        Export Data
                    </button>
                </div>
            </div>
        </div>

        <!-- NEW SECTION: Upload Training Data -->
        <div class="section training-section">
            <div class="section-header">
                <h2>Upload Training Data</h2>
                <p>Train your chatbot with custom data files - this data will be used to answer user queries</p>
            </div>
            
            <div class="upload-help">
                <div class="upload-help-icon">üí°</div>
                <div class="upload-help-text">
                    Upload structured data that the chatbot can learn from and use to answer user questions. 
                    The data will be processed, stored, and used alongside website content to generate more accurate responses.
                </div>
            </div>
            
            <form id="training-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="training-file" class="form-label">Training File</label>
                    <input 
                        type="file" 
                        id="training-file" 
                        name="trainingFile" 
                        class="form-input file-input"
                        accept=".json,.csv,.txt,.pdf"
                        required
                    >
                    <div class="form-help">
                        Supported formats: JSON, CSV, TXT, PDF (max 10MB)
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="data-category" class="form-label">Category</label>
                        <input 
                            type="text" 
                            id="data-category" 
                            name="category" 
                            class="form-input"
                            placeholder="General, FAQ, Product, etc."
                            value="General"
                        >
                    </div>
                    <div class="form-group">
                        <label for="data-source" class="form-label">Source</label>
                        <input 
                            type="text" 
                            id="data-source" 
                            name="source" 
                            class="form-input"
                            placeholder="Internal, Manual, etc."
                            value="User Upload"
                        >
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="upload-training-btn">
                        <span>üìö</span>
                        Upload & Train
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="toggleFormatGuide()">
                        <span>üìù</span>
                        Format Guide
                    </button>
                </div>
            </form>
            
            <div id="format-guide" class="format-guide" style="display: none;">
                <h4>JSON Format Guide</h4>
                <p>The chatbot can learn from various JSON structures. Here are examples:</p>
                
                <h5>1. Question-Answer format:</h5>
                <code>[
  {
    "question": "What is your return policy?",
    "answer": "You can return items within 30 days of purchase.",
    "category": "FAQ"
  },
  {
    "question": "How do I reset my password?",
    "answer": "Go to the login page and click 'Forgot Password'."
  }
]</code>

                <h5>2. Title-Content format:</h5>
                <code>[
  {
    "title": "Company History",
    "content": "Our company was founded in 2010...",
    "category": "About"
  },
  {
    "title": "Services",
    "content": "We offer the following services..."
  }
]</code>

                <h5>3. Key-Value format:</h5>
                <code>{
  "About Us": "Our company specializes in...",
  "Contact": "You can reach us at support@example.com",
  "Shipping": "We ship to all 50 states and internationally..."
}</code>
            </div>
            
            <div id="training-status-message"></div>
            
            <!-- Training Data List -->
            <div class="training-data-container">
                <h3>Existing Training Data</h3>
                <div id="training-data-list">
                    <div class="loading">Loading training data...</div>
                </div>
            </div>
        </div>

        <!-- Crawled Websites Section -->
        <div class="section websites-section">
            <div class="section-header">
                <h2>Crawled Websites</h2>
            </div>
            <div id="websites-list">
                <div class="loading">Loading websites...</div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <h3>Confirm Delete</h3>
            <p>Are you sure you want to delete this website and all its crawled data? This action cannot be undone.</p>
            <div class="modal-buttons">
                <button id="confirm-delete" class="btn btn-danger">
                    <span>üóëÔ∏è</span>
                    Delete
                </button>
                <button id="cancel-delete" class="btn btn-secondary">
                    <span>‚ùå</span>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="/admin/script.js"></script>
</body>
</html>